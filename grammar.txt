CompilationUnit:
  [PackageDeclaration] {ImportDeclaration} [TypeDeclaration]

PackageDeclaration:
  package QualifiedName ;

QualifiedName:
  Identifier {"." Identifier}

ImportDeclaration:
  SingleTypeImportDeclaration
  TypeImportOnDemandDeclaration

SingleTypeImportDeclaration:
  import QualifiedName ";"

TypeImportOnDemandDeclaration:
  import QualifiedName ".*;"

TypeDeclaration:
  ClassDeclaration
  InterfaceDeclaration
  ";"

ClassDeclaration:
  {Modifier} class Identifier [Super] [Interfaces] ClassBody

Modifier:
  public
  protected
  abstract
  final
  static
  native

Super:
  extends QualifiedName

Interfaces:
  "implements" QualifiedName {"," QualifiedName}

InterfaceDeclaration:
  {Modifier} interface Identifier [ExtendsInterfaces] InterfaceBody

ExtendsInterfaces:
  "extends" QualifiedName {"," QualifiedName}

ClassBody:
  "{" {ClassBodyDeclaration} "}"

ClassBodyDeclaration:
  ConstructorDeclaration
  FieldDeclaration
  MethodDeclaration
  ";"

ConstructorDeclaration:
  {Modifier} ConstructorDeclarator ConstructorBody

ConstructorDeclarator:
  Identifier  "(" [FormalParameterList] ")"

FormalParameterList:
  FormalParamater {, FormalParameter}

FormalParameter:
  Type Identifier

ConstructorBody:
  "{" [ExplicitConstructorInvocation] {BlockStatement} "}"

// TODO: Factor these.
FieldDeclaration:
  {Modifier} Type Identifier ["=" Expression] ";"

MethodDeclaration:
  {Modifier} ResultType MethodDeclarator MethodBody

MethodDeclarator:
  Identifier "(" [FormalParameterList] ")

ResultType:
  Type
  void

MethodBody:
  Block
  ";"

InterfaceBody:
  "{" {InterfaceMemberDeclaration} "}"

InterfaceMemberDeclaration:
  AbstractMethodDeclaration

AbstractMethodDeclaration:
  {Modifier} ResultType MethodDeclarator ";"

Block:
  "{" {BlockStatement} "}

BlockStatement:
  LocalVariableDeclaration ";"
  Statement

LocalVariableDeclaration:
  Type Identifier "=" Expression

Primary:
  "new" SingleType NewEnd
  PrimaryBase [ PrimaryEnd ]

NewEnd:
  "(" ArgumentList ")" [ PrimaryEnd ]
  "[" [Expression] "] [ PrimaryEndNoArrayAccess ]

PrimaryBase:
  Literal
  "this"
  "(" Expression ")"
  QualifiedName

PrimaryEnd:
  "[" Expression "]" [ PrimaryEndNoArrayAccess ]
  PrimaryEndNoArrayAccess

PrimaryEndNoArrayAccess:
  "." Identifier [ PrimaryEnd ]
  "(" ArgumentList ")" [ PrimaryEnd ]

ArgumentList:
  [Expression {"," Expression}]

Type:
  SingleType ["[" "]"]

SingleType:
  PrimitiveType
  QualifiedName

PrimitiveType:
  "byte"
  "short"
  "int"
  "char"
  "boolean"

ArrayAccess:
  QualifiedName [ Expression ]
  PrimaryNoNewArray [ Expression ]

Expression:
  AssignmentExpression [ "=" AssignmentExpression ]

AssignmentExpression:
  ConditionalExpression

ConditionalExpression:
  ConditionalOrExpression

ConditionalOrExpression:
  ConditionalAndExpression
  ConditionalOrExpression "||" ConditionalAndExpression

ConditionalAndExpression:
  InclusiveOrExpression
  ConditionalAndExpression && InclusiveOrExpression

AndExpression:
  EqualityExpression
  AndExpression "&" EqualityExpression

ExclusiveOrExpression:
  AndExpression
  ExclusiveOrExpression "^" AndExpression

InclusiveOrExpression:
  ExclusiveOrExpression
  InclusiveOrExpression "|" ExclusiveOrExpression

EqualityExpression:
  RelationalExpression
  EqualityExpression "==" RelationalExpression
  EqualityExpression "!=" RelationalExpression

RelationalExpression:
  AdditiveExpression
  RelationalExpression "<" AdditiveExpression
  RelationalExpression ">" AdditiveExpression
  RelationalExpression "<=" AdditiveExpression
  RelationalExpression ">=" AdditiveExpression
  RelationalExpression "instanceof" Type

AdditiveExpression:
  MultiplicativeExpression
  AdditiveExpression "+" MultiplicativeExpression
  AdditiveExpression "-" MultiplicativeExpression

MultiplicativeExpression:
  UnaryExpression
  MultiplicativeExpression "*" UnaryExpression
  MultiplicativeExpression "/" UnaryExpression
  MultiplicativeExpression "%" UnaryExpression

UnaryExpression:
  "-" UnaryExpression
  "!" UnaryExpression
  CastExpression
  Primary

CastExpression:
  "(" Type ")" UnaryExpression

ReturnStatement:
  "return" [Expression] ";"

ForStatement:
  "for" "(" [ForInit] ";" [Expression] ";" [ForUpdate] ")" Statement

ForInit:
  LocalVariableDeclaration
  Expression

ForUpdate:
  Expression

IfStatement:
  "if" "(" Expression ")" Statement ["else" Statement]

Statement:
  ";"
  Block
  ReturnStatement
  IfStatement
  ForStatement
  Expression ";"
